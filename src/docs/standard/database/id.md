テーブルのID列
====
# モチベーション
データベースのID列に自動採番をMS Sql Serverの自動採番を利用して行っているケースがあったため、その問題点が理解されていないと判断でき、それをまとめておくことに一定の意義があると考えられる。

# 一般的なID列の採番方法による特性

## 採番しない
特にID列としてカラムを定義しない。RDBでレコードを特定する方法としてID列がないというのはコッド博士(RDBを考えた人)の12の規則の 「規則 2 アクセス保証の規則」で明らかであるためここで論じない・・・極悪

## 自然キー
自然キーは、「JAコード」や「店舗コード」など業務上のカラムを指す。ID列は、RDB上のテーブル間の関連を定義する際に使用する。また画面で入力したい項目を選択するうえでオペレーションの省力化のために利用される。したがって利用箇所が多い場合、そのすべての箇所での変更や処理時間をようすること、また関連を表現する際にすべてのID列を列挙する必要があるため、自然キーの複合キーの数だけカラム名を列挙することになりメンテ性を下げる。また、桁数変更の影響が多くのテーブルに及ぶため、移行のためのシステム資源を多く利用するため避ける・・・悪

## 自動採番カラム
ここでいう自動採番はDBMSの持っている自動採番を利用する場合を指す。
プログラムでにシーケンスからIDを取得しID列にセットする場合は除く。
自動採番カラムを利用すると、バックアップ運用やテーブルの水平分散などの仕組みを後で設ける際に障害となること。データの初期投入からバックアップの戻しをする場合に問題が起きるため、運用を考えて採用しない。・・・極悪

## 固有採番カラム
自動採番カラム、自然キーを用いないならどうすればいいのでしょうか？
固有で採番を行う方法を進めます。

### データベースのシーケンスカラム
シーケンスから値を取得し、それをID列にセットする。データをインサートするために必ずID取得処理が動作し、バッチ処理など大量データを扱う場合に性能問題が発生する可能性がある。ただしレコード数に応じ線形に処理時間が延びる。テーブルに外部ツールなどを使い流し込む場合、流し込んだ後にシーケンスを手動で設定する必要がある。・・・中

### 何らかの重複しない値
UUID,ULIDなどをクライアントで採番しカラムにセットする。
人の目による確認が大変。値のセットする際は、各言語で用意されているライブラリーを利用できる。桁数（データベース上でのカラムサイズ）や、入力順の保証程度を考えてULIDを推奨する・・・良

---
サロゲートキーを摘要した場合、どのケースでも人が目でテーブルのデータを見るのには向いていない。そのため人見やすいようにRDBにビューを定義しておく。業務運用の設計としてデータ提供などがある場合、過去の提供したデータを容易に参照できるようにするためにビューを用意する。

---
_サロゲートキー:_
サロゲートキーとは、データベースのテーブルの主キーとして、自動割り当ての連続した通し番号のように、利用者や記録する対象とは直接関係のない人工的な値を用いること。 また、そのために設けられたカラムのこと