データベース設計
=====

# モチベーション

業務フローから業務で設定する項目を整理する

# データベースの概念化[ER分析]

* 業務フローから業務で使用する用語を整理する。
* エンティティーが何でユニーク(単一)になるのかを明確にする。
* アトリビュートがどのエンティティーに存在するのかを明らかにする。
* ドメインを明確にする。

# リソースに変更証跡が必要な場合の対応

データベースへの落とし込み前にエンティティに履歴が必要かを検討し必要な場合は履歴として保持できるように落とし込む。

# データベースへの落とし込み

リソースとイベントに関しては単純なためその他のテーブル類を整理する。

## リソース

リソースは要件上世代または変更履歴を持つかによって設計を分ける。

リソース
| 促成 | カラム名 | | |
|:----|------|-------|--------|
| リソースID | ResourceId | | |
| リソースコード | ResourceCode | | |
| リソース名 | ResourceName | | |

|     |     | 履歴要   | 履歴否    |
|:----|-----|-------|--------|
| 世代  | 要   | パターン① | パターン ② |
|     | 否   | パターン③ | パターン④　 |

### パターン①

世代管理要、履歴管理要

#### リソース履歴

| 促成     | カラム名       | 摘要  | 備考  |
|:-------|------------|-----|-----|
| リソースID | ResourceId |     | PK  |

#### リソース摘要開始

| 促成      | カラム名          | 摘要  | 備考  |
|:--------|---------------|-----|-----|
| リソースID  | ResourceId    |     | PK  |
| 開始日時    | StartDateTime |     | PK  |
| リソースコード | ResourceCode  |     |     |
| リソース名   | ResourceName  |     |     |

#### リソース適用終了

| 促成     | カラム名        |     |     |
|:-------|-------------|-----|-----|
| リソースID | ResourceId  |     | PK  |
| 終了日時   | EndDateTime |     | PK  |

#### 現在 リソース materialized viewで用意する

| 促成      | カラム名         |     |     |
|:--------|--------------|-----|-----|
| リソースID  | ResourceId   |     |     |
| リソースコード | ResourceCode |     |     |
| リソース名   | ResourceName |     |     |

#### リソース世代 materialized viewで用意する

| 促成      | カラム名         |     |     |
|:--------|--------------|-----|-----|
| リソースID  | ResourceId   |     |     |
| 開始日付    | StartDate    |     |     |
| 終了日付    | EndDate      |     |     |
| リソースコード | ResourceCode |     |     |
| リソース名   | ResourceName |     |     |

####         

## イベント

| 促成        | カラム名                 |              | PK  |
|:----------|:---------------------|--------------|-----|
| イベントID    | EventId              |              | ◎   |
| 発生日時      | WhenOccurred         | 入力日付         |     |
| 適用年       | WhenNoticedYear      | イベントが適用される年  |     |
| 適用年月      | WhenNoticedYearMonth | イベントが適用される年月 |     |
| 適用日時      | WhenNoticed          | イベントが適用される日時 |     |
| PartyId   | partyId              |              |     |
| PlaceId   | PlaceId              |              |     |
| ProductId | ProductId            |              |     |

## 対応表

リソース同士の関連を対応表で定義する。
原則はイベントだが世代を保持しない場合には対応表を作成する、

### 従業員

| 促成     | カラム名         |     | PK  |
|:-------|--------------|-----|-----|
| 従業員ID  | EmployeeId   |     | ◎   |
| 従業員コード | EmployeeCode |     |     |
| 従業員名   | EmployeeName |     |     |

### 部署

| 促成    | カラム名     |     | PK  |
|:------|----------|-----|-----|
| 部署ID  | PartId   |     | ◎   |
| 部署コード | PartCode |     |     |
| 部署名   | PartName |     |     |

### 従業員_部署対照表

対応表は以下の通りになる

| 属性    | カラム名       |     | PK  |
|:------|:-----------|-----|-----|
| 従業員ID | EmployeeId |     | ◎   |
| 部署ID  | PartId     |     | ◎   |

## 対照表

## サブタイプ

## みなしエンティティ

## viewの検討

* テーブル化しない判断

# データベースの実装

# 付録

その他、データベースの設計に関わる